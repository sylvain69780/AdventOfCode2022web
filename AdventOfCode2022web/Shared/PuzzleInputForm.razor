@inherits PuzzleViewBase
@inject HttpClient Http
@inject PuzzleHelper PuzzleHelper
<h3>Puzzle Input</h3>
<div>
    <label class="form-label">The data below is what is provided as example in the problem statement. You can paste your own user input.</label>
    <button class="btn-primary" @onclick=LoadFullPuzzleInput>Load a full puzzle input</button>
    <pre><textarea spellcheck="false" class="form-control" aria-label="Puzzle Input" rows="10" @bind="_input" maxlength="10000000"></textarea></pre>
</div>
@if (_input != _inputBefore)
{
    InitializePuzzle();
    _inputBefore = _input;
}
@code {

    string _input = string.Empty;
    string _inputBefore = string.Empty;

    protected override async Task OnInitializedAsync()
    {
        await LoadDefaultPuzzleInput();
        PuzzleSolutionPage!.PuzzleInputNeeded += InitializePuzzle;
        InitializePuzzle();
        await base.OnInitializedAsync();
    }

    public void Dispose() => PuzzleSolutionPage!.PuzzleInputNeeded -= InitializePuzzle;

    private async Task LoadDefaultPuzzleInput()
    {
        var puzzleInputFile = GetInputFile();
        _input = (await Http.GetStringAsync($"sample-data/{puzzleInputFile}.txt")).Replace("\r", "");
    }

    private async Task LoadFullPuzzleInput()
    {
        var puzzleInputFile = GetInputFile();
        _input = (await Http.GetStringAsync($"sample-data/{puzzleInputFile}_full.txt")).Replace("\r", "");
    }

    private string GetInputFile()
    {
        var puzzleType = PuzzleSolution!.GetType();
        var puzzleInputFile = puzzleType.Name;
        if (puzzleInputFile.Contains("Solution"))
            puzzleInputFile = puzzleInputFile.Replace("Solution", "");
        return puzzleInputFile;
    }

    private void InitializePuzzle()
    {
        PuzzleSolution!.Initialize(_input);
        PuzzleSolutionPage!.NotifyPuzzleInputLoaded();
    }
}
